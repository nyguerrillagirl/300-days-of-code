# This python script cleans up all node_modules folders
# The user provides the top-level folder/directory and this tool
# examines all child folders recursively searching for node_modules
# A file is optionally created that lists the location of node_modules folders
# that was cleaned out

# python cleanup_node_modules <top-level-folder> [-f]  [-o <output file>]

# Options:
#   <top-level-folder> is the path to the top-level folder
#   -f just check but do not remove any files
#   -o the output file to write the <path-directory> of any node_modules found


import argparse
import datetime
from pathlib import Path

parser = argparse.ArgumentParser()

parser.add_argument("path")

parser.add_argument("-l", "--long", action="store_true")

args = parser.parse_args()

target_dir = Path(args.path)

if not target_dir.exists():
    print("The target directory doesn't exist")
    raise SystemExit(1)

def build_output(entry, long=False):
    if long:
        size = entry.stat().st_size
        date = datetime.datetime.fromtimestamp(
            entry.stat().st_mtime).strftime(
            "%b %d %H:%M:%S"
        )
        return f"{size:>6d} {date} {entry.name}"
    return entry.name

for entry in target_dir.iterdir():
    print(build_output(entry, long=args.long))
